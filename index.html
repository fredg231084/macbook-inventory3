function displayProcessedData(data) {
    console.log('Displaying enhanced processed data:', data);
    
    // Handle debug/error responses
    if (data.error) {
        console.log('Debug/Error response received:', data);
        
        let previewHtml = 'ðŸ” DEBUG INFORMATION:\n\n';
        previewHtml += `Error: ${data.error}\n\n`;
        
        if (data.debug) {
            previewHtml += 'ðŸ“Š Excel File Analysis:\n';
            previewHtml += `- Total Rows: ${data.debug.totalRows || 'Unknown'}\n`;
            previewHtml += `- Sheet Names: ${data.debug.sheetNames ? data.debug.sheetNames.join(', ') : 'Unknown'}\n`;
            
            if (data.debug.headers) {
                previewHtml += `- Column Headers: ${data.debug.headers.join(', ')}\n`;
            }
            
            if (data.debug.categories) {
                previewHtml += `- Categories Found: ${data.debug.categories.join(', ')}\n`;
            }
            
            if (data.debug.brands) {
                previewHtml += `- Brands Found: ${data.debug.brands.join(', ')}\n`;
            }
            
            if (data.debug.sampleData) {
                previewHtml += '\nðŸ“‹ Sample Data (First 2 rows):\n';
                data.debug.sampleData.forEach((row, index) => {
                    previewHtml += `\nRow ${index + 1}:\n`;
                    Object.entries(row).forEach(([key, value]) => {
                        previewHtml += `  ${key}: ${value}\n`;
                    });
                });
            }
            
            if (data.debug.alternativeParsing) {
                previewHtml += '\nðŸ”„ Alternative Parsing Results:\n';
                previewHtml += `- With Header: ${data.debug.alternativeParsing.withHeader} rows\n`;
                previewHtml += `- Raw: ${data.debug.alternativeParsing.raw} rows\n`;
                if (data.debug.alternativeParsing.firstRowWithHeader) {
                    previewHtml += `- First Row Headers: ${data.debug.alternativeParsing.firstRowWithHeader.join(', ')}\n`;
                }
            }
        }
        
        dataPreview.textContent = previewHtml;
        
        // Show basic stats for debug case
        dataStats.innerHTML = `
            <div class="stat-card">
                <div class="stat-number">${data.debug?.totalRows || 0}</div>
                <div class="stat-label">Total Rows Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${data.debug?.headers?.length || 0}</div>
                <div class="stat-label">Column Headers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${data.debug?.categories?.length || 0}</div>
                <div class="stat-label">Categories</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${data.debug?.brands?.length || 0}</div>
                <div class="stat-label">Brands</div>
            </div>
        `;
        
        return;
    }
    
    // Handle success response (either debug success or normal processing)
    if (data.success) {
        let previewHtml = 'ðŸŽ‰ SUCCESS! Excel file processed successfully!\n\n';
        previewHtml += `ðŸ“Š Found ${data.totalItems} Apple products\n`;
        previewHtml += `ðŸ“‹ Total rows in file: ${data.debug?.totalRows || data.totalItems}\n`;
        
        dataStats.innerHTML = `
            <div class="stat-card">
                <div class="stat-number">${data.debug?.totalRows || data.totalItems}</div>
                <div class="stat-label">Total Items in File</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${data.totalItems}</div>
                <div class="stat-label">Apple Products Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">Ready</div>
                <div class="stat-label">Status</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">Next</div>
                <div class="stat-label">Continue to Sync</div>
            </div>
        `;
        
        dataPreview.textContent = previewHtml;
        return;
    }
    
    // Handle normal processing response (if productGroups exists)
    if (data.productGroups) {
        // Calculate total variants and collections
        const totalVariants = Object.values(data.productGroups).reduce((sum, group) => {
            return sum + Object.keys(group.variants || {}).length;
        }, 0);

        const totalCollections = new Set();
        Object.values(data.productGroups).forEach(group => {
            if (group.collections) {
                group.collections.forEach(collection => totalCollections.add(collection));
            }
        });

        // Display main statistics
        dataStats.innerHTML = `
            <div class="stat-card">
                <div class="stat-number">${data.totalItems || 0}</div>
                <div class="stat-label">Total Items Found</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${data.groupCount || 0}</div>
                <div class="stat-label">Unique Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${totalVariants}</div>
                <div class="stat-label">Product Variants</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">${totalCollections.size}</div>
                <div class="stat-label">Collections</div>
            </div>
        `;

        // Display category breakdown
        if (data.categories) {
            categoryBreakdown.innerHTML = Object.entries(data.categories)
                .map(([category, count]) => `
                    <div class="category-item">
                        <div class="category-count">${count}</div>
                        <div class="category-name">${category}</div>
                    </div>
                `).join('');
        }

        // Display enhanced preview of product groups
        let previewHtml = 'ðŸŽ¯ Enhanced Product Groups Preview:\n\n';
        const productEntries = Object.entries(data.productGroups || {});
        
        if (productEntries.length === 0) {
            previewHtml += 'âŒ No product groups found. Check your Excel file format.';
        } else {
            previewHtml += `ðŸ“Š Successfully created ${productEntries.length} optimized product listings:\n\n`;
            
            productEntries.slice(0, 8).forEach(([key, group], index) => {
                const variantCount = Object.keys(group.variants || {}).length;
                const collectionCount = (group.collections || []).length;
                
                previewHtml += `${index + 1}. ðŸ“± ${group.seoTitle}\n`;
                previewHtml += `   ðŸ·ï¸  Type: ${group.productType}\n`;
                if (group.processor && group.processor !== 'Unknown') {
                    previewHtml += `   âš¡ Processor: ${group.processor}\n`;
                }
                if (group.storage && group.storage !== 'Unknown') {
                    previewHtml += `   ðŸ’¾ Storage: ${group.storage}\n`;
                }
                if (group.memory && group.memory !== 'Unknown') {
                    previewHtml += `   ðŸ§  Memory: ${group.memory}\n`;
                }
                previewHtml += `   ðŸ“¦ Units: ${group.items?.length || 0} | Variants: ${variantCount} | Collections: ${collectionCount}\n`;
                previewHtml += `   ðŸ’° Base Price: $${group.basePrice || 'TBD'}\n\n`;
            });
            
            if (productEntries.length > 8) {
                previewHtml += `... and ${productEntries.length - 8} more optimized products\n\n`;
            }

            previewHtml += 'ðŸŽ‰ Benefits of this optimization:\n';
            previewHtml += 'âœ… SEO-friendly product titles\n';
            previewHtml += 'âœ… Organized collections for easy browsing\n';
            previewHtml += 'âœ… Condition-based pricing variants\n';
            previewHtml += 'âœ… No duplicate listings\n';
            previewHtml += 'âœ… Professional product descriptions\n';
        }

        dataPreview.textContent = previewHtml;
    }
}